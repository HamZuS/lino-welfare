Die kommende Version
====================

TODO
----

Was ich noch machen muss:

- Letzte Tests mit watch_tim.

- Im Kontextmenü haben Bilderbuttons kein Label

- Kann Partner.id nicht selbst bestimmen


Feedback erwünscht
------------------

- Datenübernahme macht noch ein paar Warnungen

- Wer kümmert sich um seriöse Icons für die neuen Bilderbuttons? 

- Der Menübefehl 
  :menuselection:`Kontakte --> Meine Personensuchen` wurde 
  ersetzt durch die Filterparameter der Tabellen 
  :menuselection:`Kontakte --> Klienten`
  und :menuselection:`DSBE --> Klienten`
  Die Anordnung der Filterparameter könnte noch auf Ergonomie überprüft werden.

- Arbeitsablauf Klienten und Begleitungen testen und dokumentieren.

  - Kommentare zu :doc:`/user/clients`. Brauchen wir nicht eher ein Wiki?

  - Bei den Aktionen RefuseNewcomer, EndCoaching und AssignCoach
    wird eine Notiz erstellt (d.h. auch vorher ein Dialogfenster gefragt). 
    Bei anderen Zustandsänderungen (z.B. Standby) nicht.
    
  - Nach erfolgreicher Zuweisung eines Klienten 
    springt er ohne viele Worte auf den nächsten Klienten. Verwirrend?

- Änderungsprotokoll. 
  Alle Änderung werden jetzt in ChangesByMaster gespeichert.
  Sind einsehbar im Detail Partner.
  Konfiguration gemeinsam anschauen und klären, welche Tabellen protokoliert werden und welche nicht.

- System-Notizen. Neuer Site-Parameter `System note type`. 
  System notes are a part of Lino's workflow management system. 
  A system note is a text message attached to a given 
  database object instance and propagated through a series of 
  configurable channels.
  The text part consists basically of a subject 
  and a body, both usually generated by the application and edited 
  by the user in an action's parameters dialog box. 
  Executing the action will then also trigger the sending of the 
  system note.

- Sollte Kerstin nicht par défaut nur die von ihr begleiteten Klienten sehen?
  Aber wer weist ihr ihre Begleitungen zu?

- Benutzer ohne Gruppe ``integ`` sehen trotzdem die DSBE-spezifische 
  Tabelle "Benutzer und ihre Klienten" im Hauptbildschirm.
  Muss das noch korrigiert werden?
  

Nach dem Release
----------------

- Verträge .odt : 
  `self.contact.person` ersetzen durch `self.contact_person` 
  `self.contact.type` ersetzen durch `self.contact_role` 


Lösung gemeldeter Probleme
--------------------------

- Kontaktperson löschen geht nicht.
  "Bei einer Firma wechselt der Direktor. 
  In den Kontaktpersonen der Firma wollen wir den alten 
  Direktor nicht mehr sehen,
  aber es gibt Verträge, bei denen er die Firma vertritt."
  --> in den Verträgen (VSE und Art 60-7) wurde das bisherige 
  Feld `contact` ersetzt durch zwei Felder `contact_person` 
  und `contact_function`. 
  Benutzung wie bisher, aber man kann jetzt in der Tabelle 
  ContactsByCompany Zeilen löschen, 
  auch wenn ein Vertrag mit dieser Kontaktperson existiert. 
  Oder wenn eine Kontaktperson vom GF zum Direktor avanciert, 
  kann man dort nun einfach das "GF" durch "Direktor" ersetzen, ohne 
  dass anschließend alle alten Verträge (nach einem "Cache löschen") 
  mit "Direktor" gedruckt würden.
  
- Tx25 hat ein paar neue TI handler.
  
- Bug "Imbiss Firat": watch_tim konnte seit 20120728 nicht mehr von 
  Person nach Firma konvertieren. Also z.B. wenn man die MWSt-Nr 
  eines Partners in TIM löschte. Dann kam die Fehlermeldung 
  "Aus TIM importierte Partner d\xfcrfen nicht gelöscht werden."

- AG-Sperren: Feld "Begründung" darf jetzt leer sein.  

- Wenn hochgeladene Datei Sonderzeichen im Namen hat, werden diese ab jetzt auf dem Server durch Unterstriche ersetzt (statt dass Lino im "Bitte warten..."-Modus steckenbleibt und der Systemverwalter per E-Mail einen Traceback  `UnicodeEncodeError 'ascii' codec can't encode character u'...' in position ...: ordinal not in range(128)` kriegt.

- "Ich habe 7 Kunden die unter VSE sind für einen Sprachkurs.
  Aber in meiner Liste "Klienten" sind die Spalten "Vertrag beginnt" 
  und "Vertrag endet" leer" 
  -->
  "Das war ein Bug. Die VSEs dieser Leute beginnen erst in der Zukunft,
  und Lino denkt sich dann "die sind noch nicht aktiv, die interessieren
  keinen". Was natürlich falsch ist."
  Behoben.

- Erstelldatum wird jetzt aus TIM synchronisiert. 
  Allerdings haben wir bisher noch keine systematische nachträgliche 
  Synchronisierung aller Partner gemacht.


Neue Features
--------------

- Willkommensgruß. Die Idee ist, dass dort idealerweise keine Warnungen stehen sollten.

- Lino unterscheidet jetzt zwischen Klienten und Personen.
  Unter "Personen" verstehen wir *alle Menschen, die Lino kennt*. 
  Das sind nicht nur Klienten, sondern auch Benutzer, 
  Kontaktpersonen in Firmen oder Institutionen usw.
  "Klienten" sind Personen, über die Lino mehr wissen will als über normale 
  Leute. 
  
  Im Detail einer Person gibt es ein Feld "ist Klient". 
  Damit kann man eine bestehende Person zu einem Klienten machen.
  
- Neue Tabelle "Klientenkontakte" ersetzt und erweitert die bisherigen Felder 
  `Ansprechpartner ADG`, `Krankenkasse`, und `Apotheke`.
  
- Neue Tabelle "Begleitungen" ersetzt die bisherigen Felder `Begleitet von/bis` und 
  `Begleiter 1 und 2`. "Begleitungsart" ist Synonym für "Dienst" (umbenennen?).
  Eine *primäre* Begleitung ist, was aus `TIM->IdUsr` importiert wurden.
  
- Arbeitsablauf Klienten und Begleitungen. 
  haben ein neues Feld "Status". 
  Das frühere Feld `is_active` wurde ersetzt durch Status "Begleitet", 
  das frühere Feld `newcomer` durch Status "Neuantrag".
  Siehe :doc:`/user/clients`.
  
- Neue Tabelle "Änderungen" auf Klienten und Verträgen zeigt 
  geloggte Änderungen im Webinterface statt in der `system.log`.

- Neue Felder "Erstellt am/um" und "Letzte Änderung" pro `Partner`.
  
- :menuselection:`Neuanträge --> Neue Klienten` hat jetzt einen Reiter "Neuanträge", 
  wo Caroline u.a. die "verfügbaren Begleiter" sehen kann und per Mausklick zuweisen kann.
  

Nebenwirkungen  
--------------

- Sorry, aber ich muss euch eine Umstrukturierung des Hauptmenüs zumuten.  
  Liegt daran, dass jetzt bald auch andere Dienste in Lino arbeiten.
  Zum Beispiel ist das Menü "Mein Menü" weg:
  die Befehle, die dort standen, sind jetzt unter ihren jeweiligen Titeln.
  Also z.B. 

  - :menuselection:`Mein Menü --> Meine VSEs` steht jetzt unter :menuselection:`DSBE --> Meine VSEs` 
  - :menuselection:`Mein Menü --> Meine Art.-60§7-Konventionen` steht jetzt unter 
    :menuselection:`DSBE --> Meine Art.-60§7-Konventionen` 
  
- Die automatische Erinnerung "Begleitung endet in 1 Monat" wird momentan 
  nicht gemacht. Ist das schlimm?
  
- countries.City.type und Partner.region.
  Visible in Detail of "All Partners" : Lino now features a field "region" 
  to specify addresses. For Belgian addresses it contains the *province*.
  This field is not usually present in Belgian sites because it's not needed 
  in our small country. But for a U.S. address 
  for example it would contain the state.

- Es gibt eine neue Tabelle "Kontenpläne" (Account Charts), in der bis 
  auf weiteres jedoch nur ein einziger Kontenplan "debts Default" steht. 
  Später kommt dort mindestens ein weiterer Kontenplan "Buchhaltung" hinzu.
 
- Database migration is automatic.
  Details see :func:`lino_welfare.modlib.pcsw.migrate.migrate_from_1_4_10`.
  
- Note that version number jumps down from 1.4.10 to 0.1.0
  Lino (the framework) changes to version 1.5.0, but this is no longer relevant 
  for database migrations. Lino/Welfare starts with 0.1.0.
  
